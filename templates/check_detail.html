<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Detail - {{ check.check_number }} - Check Validation System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <style>
        /* Grid background pattern */
        .grid-background {
            background-image: 
                linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .grid-background-hidden {
            background-image: none;
        }
    </style>
</head>
<body>

    
    <!-- Header -->
    <header class="surface-elevated sticky top-0 z-50 backdrop-blur-md bg-white/95">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-slate-800 to-slate-700 rounded-lg flex items-center justify-center">
                        <i class="fa-solid fa-file-invoice-dollar fa-lg text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold text-primary">Check {{ check.check_number }}</h1>
                        <p class="text-xs text-tertiary font-medium">DETAILED VALIDATION</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <a href="/checks/queue" class="btn-secondary">
                        <i class="fa-solid fa-arrow-left w-4 h-4 mr-2"></i>
                        Back to Queue
                    </a>
                    {% if user %}
                    <div class="flex items-center gap-4 px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg">
                        <div class="text-right">
                            <div class="text-sm font-medium text-slate-800">{{ user.name }}</div>
                            <div class="text-xs text-slate-600">{{ user.preferred_username }}</div>
                        </div>
                        <div class="w-8 h-8 bg-slate-600 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-user w-4 h-4 text-white"></i>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">

    <div class="surface rounded-xl mb-8 overflow-hidden">
        <!-- Header with Confidence Score -->
        <div class="px-6 py-4 bg-gradient-to-br from-slate-800 to-slate-700 rounded-t-xl">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-lg font-semibold text-white">Check Validation Workspace</h2>
                    <p class="text-sm text-white/80">Review image and extracted data side-by-side</p>
                </div>
                
                
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-sm text-white/70">Confidence Score:</span>
                            <span class="text-lg font-bold 
                                {% if check.confidence_score >= 0.8 %}text-green-400
                                {% elif check.confidence_score >= 0.6 %}text-yellow-400
                                {% else %}text-red-400{% endif %}">
                                {{ check.confidence_percentage }}%
                            </span>
                        </div>
                        <div class="text-xs 
                            {% if check.confidence_score >= 0.8 %}text-green-300
                            {% elif check.confidence_score >= 0.6 %}text-yellow-300
                            {% else %}text-red-300{% endif %}">
                            {% if check.confidence_score >= 0.8 %}
                                Ready for quick approval
                            {% elif check.confidence_score >= 0.6 %}
                                Review recommended
                            {% else %}
                                Manual verification required
                            {% endif %}
                        </div>
                    </div>
                    
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                        {% if check.status == 'pending' %}bg-yellow-100 text-yellow-800
                        {% elif check.status == 'approved' %}bg-green-100 text-green-800
                        {% elif check.status == 'rejected' %}bg-red-100 text-red-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ check.status | replace('_', ' ') | title }}
                    </span>
                </div>

            </div>
        </div>

            <!-- Action Controls Bar -->
            <div class="px-6 py-3 bg-slate-700 border-t border-slate-600">
                <div class="flex items-center justify-between">
                    <!-- Left Side - Image Controls -->
                    <div class="flex items-center gap-2">
                        <button id="zoomOut" class="btn-secondary px-3 py-1 text-xs">
                            <i class="fa-solid fa-minus w-3 h-3"></i>
                        </button>
                        <button id="zoomIn" class="btn-secondary px-3 py-1 text-xs">
                            <i class="fa-solid fa-plus w-3 h-3"></i>
                        </button>
                        <button id="resetZoom" class="btn-secondary px-3 py-1 text-xs">
                            <i class="fa-solid fa-expand w-3 h-3 mr-1"></i>
                            Fit
                        </button>
                        <button id="toggleGrid" class="btn-secondary px-3 py-1 text-xs bg-blue-100 text-blue-700">
                            <i class="fa-solid fa-border-all w-3 h-3 mr-1"></i>
                            Grid
                        </button>
                    </div>
                    
                    <!-- Right Side - Validation Actions -->
                    <div class="flex items-center gap-3">
                        <button id="quickApprove" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-check w-4 h-4"></i>
                            Quick Approve
                        </button>
                        <button id="sendToReview" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-magnifying-glass w-4 h-4"></i>
                            Needs Review
                        </button>
                        <button id="saveProgress" class="bg-slate-500 hover:bg-slate-400 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-save w-4 h-4"></i>
                            Save Progress
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Area - Image Left, Fields Right -->
            <div class="flex flex-col lg:flex-row min-h-[700px]">
                <!-- Left Side - Check Image -->
                <div class="lg:w-1/2 bg-gray-50 border-r border-gray-200 flex flex-col">
                    <!-- Image Container -->
                    <div class="flex-1 relative">
                        {% if check.image_data %}
                            <div id="imageContainer" class="h-full overflow-auto bg-gray-50 grid-background-hidden" style="cursor: grab;">
                                <div id="imageWrapper" class="p-4 h-full flex items-center justify-center">
                                    <img id="checkImage" 
                                        src="data:{{ check.image_mime_type }};base64,{{ check.image_data }}" 
                                        alt="Check Image - {{ check.check_number }}" 
                                        class="border shadow-lg bg-white max-w-full max-h-full object-contain"
                                        style="transform: scale(0.9) translate(0px, 0px); transition: transform 0.1s ease-out;"
                                        draggable="false"
                                        onload="console.log('Image loaded successfully')"
                                        onerror="console.error('Image failed to load'); this.style.display='none'; document.getElementById('imageError').style.display='flex';">
                                </div>
                            </div>
                            
                            <!-- Hidden error fallback -->
                            <div id="imageError" style="display: none;" class="h-full bg-red-50 border-2 border-dashed border-red-300 flex items-center justify-center">
                                <div class="text-center">
                                    <i class="fa-solid fa-exclamation-triangle w-16 h-16 text-red-400 mb-4"></i>
                                    <h3 class="text-lg font-medium text-red-600 mb-2">Image Load Error</h3>
                                    <p class="text-sm text-red-500">Unable to display check image</p>
                                </div>
                            </div>

                        {% else %}
                            <!-- Placeholder when no image available -->
                            <div class="h-full bg-gray-100 border-2 border-dashed border-gray-300 flex items-center justify-center">
                                <div class="text-center">
                                    <i class="fa-solid fa-image w-16 h-16 text-gray-400 mb-4"></i>
                                    <h3 class="text-lg font-medium text-gray-600 mb-2">No Image Available</h3>
                                    <p class="text-sm text-gray-500">
                                        {% if check.file_name %}
                                            File: {{ check.file_name }}
                                        {% else %}
                                            No image data found
                                        {% endif %}
                                    </p>
                                    {% if check.file_id %}
                                    <p class="text-xs text-gray-400 mt-1">File ID: {{ check.file_id }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Image Info Bar -->
                    <div class="px-4 py-2 bg-gray-100 border-t border-gray-200 flex items-center justify-between text-xs text-gray-600">
                        <div class="flex items-center gap-4">
                            {% if check.file_name %}
                            <span><i class="fa-solid fa-file mr-1"></i>{{ check.file_name }}</span>
                            {% endif %}
                            <span id="imageDimensions"><i class="fa-solid fa-ruler-combined mr-1"></i></span>
                        </div>
                        <div class="flex items-center gap-4">
                            <span><i class="fa-solid fa-mouse-pointer mr-1"></i>Drag to pan</span>
                            <span id="zoomLevel">90%</span>
                        </div>
                    </div>
                </div>

                <!-- Right Side - Check Details Form -->
<div class="lg:w-1/2 bg-white border-l-2 border-gray-300">
    <div class="p-6 h-full overflow-y-auto">
        <form id="checkDetailsForm">
            <!-- Extracted Fields Grid -->
            <div class="space-y-5">
                <!-- Payee Information -->
                <div class="space-y-3">
                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
                        <i class="fa-solid fa-user mr-2 text-gray-700"></i>Payee Information
                    </h3>
                    
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Payee Name</label>
                            <input type="text" value="{{ check.payee_name }}" 
                                   class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   name="payee_name">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Pay To</label>
                            <input type="text" value="{{ check.pay_to }}" 
                                   class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   name="pay_to">
                        </div>
                    </div>
                </div>

                <!-- Amount & Date -->
                <div class="space-y-3">
                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
                        <i class="fa-solid fa-dollar-sign mr-2 text-gray-700"></i>Amount & Date
                    </h3>
                    
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Amount</label>
                            <input type="text" value="{{ check.amount }}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors font-semibold text-green-700"
                                   name="amount">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Check Date</label>
                                <input type="date" value="{{ check.check_date }}" 
                                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                       name="check_date">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Check Number</label>
                                <input type="text" value="{{ check.check_number }}" 
                                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                       name="check_number">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Banking Information -->
                <div class="space-y-3">
                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
                        <i class="fa-solid fa-university mr-2 text-gray-700"></i>Banking Information
                    </h3>
                    
                    <div class="grid grid-cols-1 gap-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Routing Number</label>
                                <input type="text" value="{{ check.routing_number }}" 
                                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors font-mono"
                                       name="routing_number">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Account Number</label>
                                <input type="text" value="{{ check.account_number }}" 
                                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors font-mono"
                                       name="account_number">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">MICR Line</label>
                            <input type="text" value="{{ check.micr_line }}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors font-mono text-sm"
                                   name="micr_line">
                        </div>
                    </div>
                </div>

                <!-- Case Information -->
                <div class="space-y-3">
                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
                        <i class="fa-solid fa-briefcase mr-2 text-gray-700"></i>Case Information
                    </h3>
                    
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Matter Name</label>
                            <input type="text" value="{{ check.matter_name }}" 
                                   class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   name="matter_name">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Case Type</label>
                                <input type="text" value="{{ check.case_type }}" 
                                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                       name="case_type">
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">Delivery Service</label>
                                <input type="text" value="{{ check.delivery_service }}" 
                                       class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                       name="delivery_service">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="space-y-3">
                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
                        <i class="fa-solid fa-sticky-note mr-2 text-gray-700"></i>Additional Information
                    </h3>
                    
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Memo</label>
                        <textarea 
                               class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none"
                               name="memo" rows="2">{{ check.memo }}</textarea>
                    </div>
                </div>

                <!-- System Information -->
                <div class="space-y-3">
                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
                        <i class="fa-solid fa-cog mr-2 text-gray-700"></i>System Information
                    </h3>
                    
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Salesforce ID</label>
                            <input type="text" value="{{ check.salesforce_id }}" 
                                   class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg font-mono text-sm"
                                   name="salesforce_id" readonly>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Created At</label>
                            <input type="text" value="{{ check.created_at[:19] if check.created_at else '' }}" 
                                   class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-sm"
                                   readonly>
                        </div>
                    </div>
                </div>

                <!-- Validation Flags -->
                {% if check.flags %}
                <div class="space-y-3">
                    <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wide border-b border-gray-200 pb-2">
                        <i class="fa-solid fa-flag mr-2 text-gray-700"></i>Validation Flags
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        {% for flag in check.flags %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                            <i class="fa-solid fa-exclamation-triangle w-3 h-3 mr-1"></i>
                            {{ flag | replace('_', ' ') | title }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </form>
    </div>
</div>
            
            
            
            
            </div>
        </div>

        


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const checkImage = document.getElementById('checkImage');
            const imageContainer = document.getElementById('imageContainer');
            const imageWrapper = document.getElementById('imageWrapper');
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');
            const resetZoomBtn = document.getElementById('resetZoom');
            const toggleGridBtn = document.getElementById('toggleGrid');
            const imageDimensions = document.getElementById('imageDimensions');
            const zoomLevel = document.getElementById('zoomLevel');
            
            // Enhanced pan and zoom state
            let currentZoom = 0.9;
            let panX = 0;
            let panY = 0;
            let isDragging = false;
            let lastX = 0;
            let lastY = 0;
            let isMouseDown = false;
            let dragThreshold = 3;
            let gridVisible = true;
            
            // Update display when image loads
            if (checkImage) {
                checkImage.onload = function() {
                    updateImageDimensions();
                    updateZoomLevel();
                };
            }
            
            function updateTransform() {
                if (checkImage) {
                    checkImage.style.transform = `scale(${currentZoom}) translate(${panX}px, ${panY}px)`;
                }
            }
            
            function updateZoomLevel() {
                if (zoomLevel) {
                    zoomLevel.textContent = Math.round(currentZoom * 100) + '%';
                }
            }
            
            function centerImage() {
                panX = 0;
                panY = 0;
                updateTransform();
            }
            
            function updateImageDimensions() {
                if (checkImage && imageDimensions) {
                    imageDimensions.textContent = `${checkImage.naturalWidth} Ã— ${checkImage.naturalHeight}px`;
                }
            }
            
            // Zoom function that always centers to image center
            function zoomToCenter(zoomChange) {
                const newZoom = Math.min(Math.max(currentZoom * zoomChange, 0.1), 5);
                
                if (newZoom !== currentZoom) {
                    // Always zoom to the center of the image
                    currentZoom = newZoom;
                    // Reset pan to center when zooming via buttons
                    panX = 0;
                    panY = 0;
                    updateTransform();
                    updateZoomLevel();
                }
            }
            
            // Zoom button controls - always snap to center
            if (zoomInBtn) {
                zoomInBtn.addEventListener('click', () => {
                    zoomToCenter(1.3);
                });
            }
            
            if (zoomOutBtn) {
                zoomOutBtn.addEventListener('click', () => {
                    zoomToCenter(0.77);
                });
            }
            
            if (resetZoomBtn) {
                resetZoomBtn.addEventListener('click', () => {
                    currentZoom = 0.9;
                    centerImage();
                    updateZoomLevel();
                });
            }


            
        // Update the grid toggle functionality section:
        if (toggleGridBtn && imageContainer) {
            // Set initial state - grid visible by default
            imageContainer.classList.remove('grid-background-hidden');
            imageContainer.classList.add('grid-background');
            toggleGridBtn.classList.add('bg-blue-100', 'text-blue-700');
            
            toggleGridBtn.addEventListener('click', () => {
                gridVisible = !gridVisible;
                if (gridVisible) {
                    imageContainer.classList.remove('grid-background-hidden');
                    imageContainer.classList.add('grid-background');
                    toggleGridBtn.classList.add('bg-blue-100', 'text-blue-700');
                } else {
                    imageContainer.classList.remove('grid-background');
                    imageContainer.classList.add('grid-background-hidden');
                    toggleGridBtn.classList.remove('bg-blue-100', 'text-blue-700');
                }
            });
        }
            
            // Enhanced drag functionality
            function startDrag(clientX, clientY) {
                isDragging = false; // Will become true only if mouse moves
                isMouseDown = true;
                lastX = clientX;
                lastY = clientY;
                imageContainer.style.cursor = 'grabbing';
                imageContainer.style.userSelect = 'none';
            }
            
            function updateDrag(clientX, clientY) {
                if (!isMouseDown) return;
                
                const deltaX = clientX - lastX;
                const deltaY = clientY - lastY;
                
                // Only start dragging if mouse has moved a minimum distance
                if (!isDragging && (Math.abs(deltaX) > dragThreshold || Math.abs(deltaY) > dragThreshold)) {
                    isDragging = true;
                }
                
                if (isDragging) {
                    // Scale the movement by zoom level for more natural feel
                    panX += deltaX / currentZoom;
                    panY += deltaY / currentZoom;
                    updateTransform();
                }
                
                lastX = clientX;
                lastY = clientY;
            }
            
            function endDrag() {
                isDragging = false;
                isMouseDown = false;
                imageContainer.style.cursor = 'grab';
                imageContainer.style.userSelect = '';
            }
            
            // Mouse events
            if (imageContainer) {
                imageContainer.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    startDrag(e.clientX, e.clientY);
                });
                
                document.addEventListener('mousemove', (e) => {
                    updateDrag(e.clientX, e.clientY);
                });
                
                document.addEventListener('mouseup', endDrag);
                
                imageContainer.addEventListener('mouseleave', () => {
                    if (!isDragging) {
                        imageContainer.style.cursor = 'grab';
                    }
                });
                
                imageContainer.addEventListener('mouseenter', () => {
                    if (!isMouseDown) {
                        imageContainer.style.cursor = 'grab';
                    }
                });
            }
            
            // Touch events for mobile support
            if (imageContainer) {
                imageContainer.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (e.touches.length === 1) {
                        const touch = e.touches[0];
                        startDrag(touch.clientX, touch.clientY);
                    }
                });
                
                imageContainer.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (e.touches.length === 1) {
                        const touch = e.touches[0];
                        updateDrag(touch.clientX, touch.clientY);
                    }
                });
                
                imageContainer.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    endDrag();
                });
            }
            
            // Prevent image dragging
            if (checkImage) {
                checkImage.addEventListener('dragstart', (e) => {
                    e.preventDefault();
                });
            }
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                switch(e.key) {
                    case '+':
                    case '=':
                        e.preventDefault();
                        zoomToCenter(1.3);
                        break;
                    case '-':
                        e.preventDefault();
                        zoomToCenter(0.77);
                        break;
                    case '0':
                        e.preventDefault();
                        currentZoom = 1;
                        centerImage();
                        updateZoomLevel();
                        break;
                    case 'r':
                    case 'R':
                        e.preventDefault();
                        currentZoom = 0.9;
                        centerImage();
                        updateZoomLevel();
                        break;
                    case 'g':
                    case 'G':
                        e.preventDefault();
                        toggleGridBtn.click();
                        break;
                }
            });

            // NEW: Quick Approve functionality
            document.getElementById('quickApprove')?.addEventListener('click', function() {
                if (confirm('Are you sure you want to approve this check?')) {
                    alert('Quick approve functionality will be implemented next');
                }
            });

            // NEW: Send to Review functionality
            document.getElementById('sendToReview')?.addEventListener('click', function() {
                document.getElementById('reviewModal').classList.remove('hidden');
            });

            // NEW: Save Progress functionality  
            document.getElementById('saveProgress')?.addEventListener('click', function() {
                alert('Save progress functionality will be implemented next');
            });

            // NEW: Review modal handlers
            document.getElementById('cancelReview')?.addEventListener('click', function() {
                document.getElementById('reviewModal').classList.add('hidden');
            });

            document.getElementById('confirmReview')?.addEventListener('click', function() {
                const reason = document.getElementById('reviewReason').value;
                const notes = document.getElementById('reviewNotes').value.trim();
                const priority = document.querySelector('input[name="priority"]:checked')?.value;
                
                if (!reason) {
                    alert('Please select a reason for review');
                    return;
                }
                
                // Here you would send the review data to your backend
                console.log('Review data:', { reason, notes, priority });
                alert('Check sent to review queue');
                document.getElementById('reviewModal').classList.add('hidden');
            });


        });
    </script>
</body>
</html>